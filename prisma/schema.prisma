generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Extract {
  id            String            @id @default(cuid())
  title         String
  extract       String?
  notes         String?
  sourceUrl     String?
  michelinStars Int               @default(0)
  formatId      String
  parentId      String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  publishedOn   DateTime?
  childOrder    Int               @default(0)
  attachments   Attachment[]
  format        ExtractFormat    @relation(fields: [formatId], references: [id])
  parent        Extract?          @relation("ParentChild", fields: [parentId], references: [id])
  children      Extract[]         @relation("ParentChild")
  relatedFrom   ExtractRelation[] @relation("relatedFrom")
  relatedTo     ExtractRelation[] @relation("relatedTo")
  creators      Creator[]         @relation("ExtractCreators")
  spaces        Space[]           @relation("ExtractSpaces")
}

model ExtractRelation {
  fromId     String
  toId       String
  annotation String?
  from       Extract @relation("relatedFrom", fields: [fromId], references: [id])
  to         Extract @relation("relatedTo", fields: [toId], references: [id])

  @@id([fromId, toId])
}

model ExtractFormat {
  id       String    @id @default(cuid())
  name     String
  extracts Extract[]
}

model Attachment {
  id        String  @id @default(cuid())
  url       String
  caption   String?
  altText   String?
  extractId String
  extension String?
  extract   Extract @relation(fields: [extractId], references: [id])
}

model Creator {
  id        String    @id @default(cuid())
  name      String
  siteUrl   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  extracts  Extract[] @relation("ExtractCreators")
}

model Space {
  id          String    @id @default(cuid())
  topic       String
  title       String?
  icon        String?
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  extracts    Extract[] @relation("ExtractSpaces")
}
